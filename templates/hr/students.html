<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HR Students - WAPL</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Segoe UI',Tahoma; background:#f5f7fa; }

.container { display:flex; min-height:100vh; }

/* ===== Sidebar (IDENTICAL TO DASHBOARD) ===== */
.sidebar {
    width:250px;
    background:linear-gradient(180deg,#1e3c72,#2a5298);
    color:white;
    padding:20px 0;
    position:fixed;
    height:100vh;
    display:flex;
    flex-direction:column;
}

.logo {
    padding:0 20px 30px;
    border-bottom:1px solid rgba(255,255,255,0.1);
    margin-bottom:20px;
}

.logo h2 { font-size:24px; font-weight:bold; }

.nav-menu {
    padding:0 10px;
    display:flex;
    flex-direction:column;
    flex:1;
}

.nav-menu a,
.nav-menu button {
    width:100%;
    display:flex;
    align-items:center;
    padding:12px 20px;
    color:rgba(255,255,255,0.85);
    border-radius:8px;
    margin-bottom:6px;
    background:transparent;
    border:none;
    cursor:pointer;
    font-size:14px;
    text-decoration:none;
}

.nav-menu a.active,
.nav-menu a:hover,
.nav-menu button:hover {
    background:rgba(255,255,255,0.2);
    color:white;
}

.nav-menu button {
    margin-top:auto;
}

/* ===== Main ===== */
.main {
    margin-left:250px;
    padding:30px;
    width:calc(100% - 250px);
}

.header {
    padding:20px 30px;
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white;
    border-radius:12px;
    margin-bottom:30px;
}

.filters {
    display:flex;
    gap:10px;
    margin-bottom:20px;
}

.filters select,
.filters input {
    padding:10px;
    border-radius:8px;
    border:1px solid #ccc;
}

.students-grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
    gap:20px;
}

.student-card {
    background:white;
    padding:20px;
    border-radius:12px;
    box-shadow:0 2px 12px rgba(0,0,0,0.08);
}

.student-card img {
    width:100%;
    height:160px;
    object-fit:cover;
    border-radius:8px;
    margin-bottom:10px;
}

.btn {
    display:inline-block;
    margin-top:10px;
    padding:10px 18px;
    border-radius:8px;
    background:linear-gradient(135deg,#667eea,#764ba2);
    color:white;
    text-decoration:none;
    font-weight:600;
}
</style>
</head>

<body>
<div class="container">

<aside class="sidebar">
    <div class="logo"><h2>üè¢ WAPL HR</h2></div>
    <nav class="nav-menu">
        <a href="/hr/dashboard">üìä Dashboard</a>
        <a href="/hr/profile">üë§ Profile</a>
        <a href="/hr/students" class="active">üë• Students</a>
        <button onclick="logout()">üö™ Logout</button>
    </nav>
</aside>

<main class="main">

<div class="header">
    <h1>Assigned Students</h1>
</div>

<div class="filters">
    <select id="domainFilter"><option value="">All Domains</option></select>
    <input type="text" id="skillsFilter" placeholder="Filter by skills">
    <button class="btn" onclick="applyFilters()">Filter</button>
</div>

<div id="studentsList" class="students-grid">
    <p>Loading students...</p>
</div>

</main>
</div>

<script>
let allStudents=[];

async function loadDomains(){
    const r=await fetch('/api/domains/active');
    const d=await r.json();
    const s=document.getElementById('domainFilter');
    d.forEach(x=>{
        const o=document.createElement('option');
        o.value=x.id; o.textContent=x.domain_name;
        s.appendChild(o);
    });
}

async function loadStudents(){
    const r=await fetch('/api/hr/students');
    const d=await r.json();
    allStudents=d;
    renderStudents(d);
}

function renderStudents(students){
    const c=document.getElementById('studentsList');
    if(!students.length){ c.innerHTML='<p>No students</p>'; return; }
    c.innerHTML=students.map(s=>`
        <div class="student-card">
            ${s.profile_pic?`<img src="/${s.profile_pic}">`:''}
            <h3>${s.full_name}</h3>
            <p><b>WAPL ID:</b> ${s.wapl_id}</p>
            <p><b>Email:</b> ${s.email}</p>
            <a href="/hr/student/${s.id}" class="btn">View Profile</a>
        </div>
    `).join('');
}

function applyFilters(){
    const d=domainFilter.value;
    const k=skillsFilter.value;
    let u='/api/hr/students/filter?';
    if(d) u+=`domain_id=${d}&`;
    if(k) u+=`skills=${encodeURIComponent(k)}`;
    fetch(u).then(r=>r.json()).then(renderStudents);
}

async function logout(){
    await fetch('/api/auth/logout',{method:'POST'});
    location.href='/login';
}

loadDomains();
loadStudents();
</script>
</body>
</html>
